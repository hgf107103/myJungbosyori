<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>신기술동향 문제풀이</title>
    <script src="jquery-3.5.1.min.js"></script>
    <script src="questList.js"></script>
    <style>
        @font-face {
            font-family: 'DXgothic';
            src: url(DX경필고딕B.ttf) format('truetype');
        }

        *{
            font-family: "DXgothic";
            margin: 0px 0px;
            padding: 0px 0px;
        }
        *:focus {
            outline: none;
        }
        body {
            margin-bottom: 80px;
        }
        header {
            width: 80%;
            text-align: center;
            margin: 40px auto;
        }
        header label {
            font-size: 30px;
        }
        header input {
            text-align: center;
            width: 10%;
            cursor: default;
            padding: 5px 20px;
            font-size: 25px;
            border: none;;
            border-right: 2px solid rgb(230,230,230);
            border-bottom: 2px solid rgb(230,230,230);
        }
        div {
            margin: auto;
            width: 50%;
            line-height: 40px;
            font-size: 30px;
            cursor: default;
        }
        div#questBox {
            margin: 30px auto;
            border: 1px solid black;
            border-radius: 20px;
            padding: 60px 80px;
            text-align: center;
        }
        div#answerBox{
            padding: 20px 30px;
        }
        div input {
            display: block;
            margin: 5px auto;
        }
        div input[type=text] {
            text-align: center;
            padding: 10px 50px;
            width: 55%;
            font-size: 25px;
            border: none;
            border-bottom: 2px solid rgb(200,200,200);
            
            transition: all ease 1s;
        }
        div input[type=text]:hover {
            border-bottom: 2px solid rgb(150,150,150);
            transition: all ease 1s;
        }
        div input[type=text]:focus {
            border-bottom: 2px solid rgb(10,10,10);
            transition: all ease 1s;
        }
        div input[type=button] {
            text-align: center;
            margin-top: 15px;
            padding: 10px 30px;
            width: 35%;
            font-size: 23px;
            border: 1px solid rgb(150,150,150);
            border-radius: 5px;
            background-color: rgb(250,250,250);
            cursor: pointer;
            transition: all ease 1s;
        }
        div input[type=button]:hover {
            border: 1px solid black;
            transition: all ease 1s;
        }
        div span {
            color: red;
        }
    </style>
    <script>
        let lapCnt = 1;
        let sayAnswerCnt = 0;
        let correctAnswerRate = 0;
        let listCnt = 1;
        let list;
        let wrongList = new Array;

        function count() {//카운터 표시하는 함수
            $("#lap").val(lapCnt);
            $("#sayAnswer").val(sayAnswerCnt);
            if (sayAnswerCnt >= 1) {
                $("#correctAnswer").val(`${Math.floor((correctAnswerRate / sayAnswerCnt) * 100)}%`);
            }
        }
        function start() {//문제풀이 시작함수
            alert("시작합니다.");
            list = getList();
            shuffle(list);
            $("#questBox").text(list[0].quest);
            document.getElementById("startBtn").style.display = "none";
            document.getElementById("sayBtn").style.display = "block";
            document.getElementById("myAnswer").style.display = "block";
            count();
        }
        function sayAnswerFunction() {//문제 답 날렸을떄 반응
            if (($("#myAnswer").val() == list[listCnt - 1].korAnswer || $("#myAnswer").val() == list[listCnt - 1].engAnswer || $("#myAnswer").val() == list[listCnt - 1].engFullname) && $("#myAnswer").val() != "") {
               
                $("#myAnswer").val('');
                correctAnswerRate++;
                seeAnswerFunction();
                return;

            } else if (($("#myAnswer").val().toUpperCase() == list[listCnt - 1].korAnswer.toUpperCase() || $("#myAnswer").val().toUpperCase() == list[listCnt - 1].engAnswer.toUpperCase() || $("#myAnswer").val().toUpperCase() == list[listCnt - 1].engFullname.toUpperCase()) && $("#myAnswer").val() != "") {

                $("#myAnswer").val('');
                correctAnswerRate++;
                seeAnswerFunction();
                return;

            } else if ($("#myAnswer").val() != list[listCnt - 1].korAnswer || $("#myAnswer").val() != list[listCnt - 1].engAnswer || $("#myAnswer").val() != list[listCnt - 1].engFullname || $("#myAnswer").val() == "") {
                
                alert('오답!');
                $("#myAnswer").val('');
                document.getElementById("reBtn").style.display = "block";
            }

            document.getElementById("sayBtn").style.display = "none";
            document.getElementById("seeBtn").style.display = "block";
            
        }

        function seeAnswerFunction() {//해답 보여주기 함수
            $("#questBox").html(`${list[listCnt - 1].quest}<br><br>정답<br>한글 <span>${list[listCnt - 1].korAnswer}</span><br>영(약) <span>${list[listCnt - 1].engAnswer}</span><br>영(풀) <span>${list[listCnt - 1].engFullname}</span>`);
            document.getElementById("sayBtn").style.display = "none";
            document.getElementById("seeBtn").style.display = "none";
            document.getElementById("myAnswer").style.display = "none";
            document.getElementById("reBtn").style.display = "none";

            if (listCnt == list.length) {//모든 문제를 다 풀었을때
                document.getElementById("newBtn").style.display = "block";
                if (Array.isArray(wrongList) && wrongList.length <= 0) {
                    document.getElementById("reStartBtn").style.display = "none";
                } else if (Array.isArray(wrongList) && wrongList.length > 0) {
                    document.getElementById("reStartBtn").style.display = "block";
                }
                document.getElementById("myAnswer").style.display = "none";
                return;
            }

            document.getElementById("nextBtn").style.display = "block";
            
        }


        function nextAnswerFunction() {//다음문제 함수
            sayAnswerCnt++
            listCnt++;
            console.log(listCnt);
            console.log(list);
            $("#questBox").text(list[listCnt - 1].quest);

            document.getElementById("nextBtn").style.display = "none";
            document.getElementById("sayBtn").style.display = "block";
            document.getElementById("myAnswer").style.display = "block";
            count();
        }


        function newAnswerFunction() {//새로 시작하는 함수
            lapCnt++;
            count();
            list = getList();
            shuffle(list);
            listCnt = 0;
            document.getElementById("newBtn").style.display = "none";
            document.getElementById("myAnswer").style.display = "block";
            nextAnswerFunction();
        }




        function reQuestStartFunction() {
            let temp = new Array;
            
            $.each(wrongList, (index, item) => {
                temp.push(list[item]);
            })
            list = temp;
            wrongList = [];

            lapCnt++;
            count();
            shuffle(list);
            listCnt = 0;
            document.getElementById("newBtn").style.display = "none";
            document.getElementById("myAnswer").style.display = "block";
            document.getElementById("reStartBtn").style.display = "none";
            nextAnswerFunction();
        }
    </script>
</head>
<body>
    <header>
        <label>현재 회차<input class="headerInput" type="number" name="lap" id="lap" readonly value="0"></label>
        <label>　푼 문제<input class="headerInput" type="number" name="sayAnswer" id="sayAnswer" readonly value="0"></label>
        <label>　정답률<input class="headerInput" type="text" name="correctAnswer" id="correctAnswer" readonly value="0%"></label>
    </header>
    <div id="questBox">
        신기술 동향 문제풀이 시작하시겠습니까?
    </div>
    <div id="answerBox">
        <input type="text" name="myAnswer" id="myAnswer" style="display: none;" placeholder="한글 및 영어 약자, 영어 풀네임으로 적어주십시오">
        <input type="button" onclick="start()" id="startBtn" style="display: block;" value="시작하기">
        <input type="button" onclick="sayAnswerFunction()" id="sayBtn" style="display: none;" value="답맞추기">
        <input type="button" onclick="sayAnswerFunction()" id="reBtn" style="display: none;" value="다시풀기">
        <input type="button" onclick="let check = confirm('해답을 보시겠습니까?'); if(check == true) { wrongList.push(listCnt - 1); seeAnswerFunction();}" id="seeBtn" style="display: none;" value="해답보기">
        <input type="button" onclick="nextAnswerFunction()" id="nextBtn" style="display: none;" value="다음문제">
        <input type="button" onclick="newAnswerFunction()" id="newBtn" style="display: none;" value="처음부터">
        <input type="button" onclick="reQuestStartFunction()" id="reStartBtn" style="display: none;" value="오답풀기">
    </div>
</body>
</html>